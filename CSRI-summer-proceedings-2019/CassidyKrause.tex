\documentclass{csri19}

%%% Starting page will be changed when we combine the proceedings
\setcounter{page}{3}

% PACKAGES ---------------------------------------------------------------
\usepackage{amsfonts,amsmath,graphicx,subfigure}
% ADD YOUR OWN PACKAGES HERE ---------------------------------------------
\usepackage{mathtools, amssymb}

% DEFINITIONS ------------------------------------------------------------
% ADD YOUR OWN DEFINITIONS HERE ------------------------------------------
% BE SURE TO PREFACE LABEL WITH YOUR OWN INITIALS (SSS in this example) --
\newcommand{\SSSnorm}[1]{\left\Vert#1\right\Vert}
\newcommand{\SSSabs}[1]{\left\vert#1\right\vert}
\newcommand{\CFKg}{\mathfrak{g}}

\newcommand{\A}[1]{\textbf{ANDREW:}\textit{#1}}

% This controls the table-of-contents entry in the proceedings. Edit it
% to include your article title followed by the authors' names, as shown.
\addcontentsline{toc}{chapter}{Exponential Integrators for the HOMME-NH
Nonhydrostatic Atmosphere Model\\
{\em C.F.\ Krause and A.J.\ Steyer}}

\pagestyle{myheadings}

\thispagestyle{plain}

% This gives the running head. Usually you list a shortened version of
% your article title (unless it's already very short) along with
% the author's names, as shown.
\markboth{Exponential Integrators for HOMME-NH}{C.F.\ Krause and 
 A.J.\ Steyer}

% Put your article title in here
\title{Exponential Integrators for the HOMME-NH Nonhydrostatic Atmosphere
 Model}

% List each author, their affiliation, and their e-mail address, as shown.
\author{Cassidy F.\ Krause\thanks{University of Kansas, ckrause@ku.edu}
\and Andrew J.\ Steyer\thanks{Sandia National Laboratories, 
  asteyer@sandia.gov}}

\begin{document}
\maketitle

% Include your abstract here.
\begin{abstract}
Time-stepping in the HOMME-NH nonhydrostatic atmosphere model requires 
integration of a stiff initial value problem. The current implementation in 
HOMME-NH uses implicit-explicit Runge-Kutta (IMEX RK) methods with a 
horizontally explicit vertically implicit (HEVI) partitioning. We introduce 
a horizontally explicit vertically integrating factor exponential (HEVIE) 
method as an alternative to solving these stiff equations. The benefit of 
exponential methods is that they allow a larger step-size than explicit 
methods; however, their main drawback is the cost of forming the matrix 
exponential. Here, we show that we can mitigate this cost by taking 
advantage of the tridiagonal-like form of our Jacobian and parallelizing 
our computations, making this solver an attractive option for HOMME-NH.
\end{abstract}

\section{Introduction} \label{CFK:sec:intro}
Stiff initial value problems are a challenge for nonhydrostatic 
atmosphere models like HOMME-NH, described in \cite{CFK:preprint}. Several 
methods have been proposed to avoid the step-size restriction associated 
with stiff problems, including implicit-explicit Runge-Kutta (IMEX RK) 
methods, which are currently implemented in HOMME-NH. Here, we investigate 
integrating factor Runge-Kutta (IFRK) methods, a class of exponential 
integrators, as an alternative approach to dealing with the stiff initial 
value problems in HOMME-NH.

Consider an additively partitioned differential equation of the form 
\begin{equation}\label{CFK:eqn:ode} 
\omega_t = f(\omega) = s(\omega) + n(\omega),\end{equation} where 
$\omega \in \mathbb{R}^n$, and $\omega_t$ denotes the derivative with 
respect to time. With this partitioning, $s(\omega)$ contains the stiff 
part of the equation, and $n(\omega)$ contains the nonstiff part. In 
HOMME-NH, we wish to solve an initial value problem of the form 
\ref{CFK:eqn:ode} with initial condition $\omega_0 = \omega(t_0)$. 

IMEX methods are partitioned methods for approximating initial value 
problems of additively partitioned differential equations that treat the 
stiff terms implicitly and the nonstiff terms explicitly. The 
implementation and performance of various IMEX RK methods for integration 
of HOMME-NH with a horizontally explicit vertically implicit (HEVI) 
partitioning are discussed in \cite{CFK:Steyer2019}.

In this paper, we consider IFRK methods (\cite{CFK:Minchev2006}) as 
an alternative integrator for HOMME-NH with a horizontally explicit 
vertically integrating factor exponential (HEVIE) partitioning. Given an 
approximate solution trajectory $\omega_m \approx \omega(t_m)$, we define 
a new additive partitioning of \ref{CFK:eqn:ode} by linearizing the stiff 
part, $s(\omega)$, along $\omega_m$. Often, $L_m = f'(\omega)$, but we do 
not assume this is the case. Let $L_m=\frac{\partial s}{\partial{\omega}}
(\omega_m)$, and set $N_m(\omega) = f(\omega) - L_m \omega$. With IFRK 
methods, we split our equation as \[ \omega_t = f(\omega) = L_m\omega +  
N_m(\omega).\] With this partitioning, $L_m$ is a  linear operator 
containing the stiff part of the equation, and $N_m(\omega)$ contains the 
nonstiff terms. Using the change of variables $\nu(t)=e^{-L_m(t-t_m)}
\omega(t)$, we have 
\begin{equation}\label{CFK:eqn:vode}
\nu_t = e^{-L_m(t-t_m)}N_m(e^{L_m(t-t_m)}\nu). \end{equation} 
We then use a fully explicit $r-$stage RK method to solve equation 
\ref{CFK:eqn:vode}, as explained in Section \ref{CFK:sec:ifrk}.

While exponential integrators allow for a larger time step than explicit 
methods, a major drawback is the computational cost of forming the matrix 
exponential. For this reason, matrix exponential methods were seldom used 
in practice, but advances in efficiently forming $e^A$ have recently made 
exponential-type methods a competitive choice for integrating stiff initial 
value problems (e.g., \cite{CFK:Clancy2013}, \cite{CFK:Garcia2014}). 
Furthermore, the Jacobian obtained from linearizing the stiff terms in 
HOMME-NH is sparse, with a tridiagonal block and a block that is a scalar 
multiple of the identity (Equation \ref{CFK:eqn:Jacobian}). This structure 
allows us to form these matrix exponentials quickly and in parallel over 
the horizontal mesh, making this approach a viable alternative to the IMEX 
RK methods.

The rest of the paper is structured as follows: In Section 
\ref{CFK:sec:matexp} we give a brief background of numerical approximations 
of the matrix exponential; Section \ref{CFK:sec:homme} discusses the 
implementation of IFRK methods with HOMME-NH; Section \ref{CFK:sec:ifrk} 
details the specific IFRK methods we use in this paper; and numerical 
results are given in Section \ref{CFK:sec:results}.

\section{Numerical Approximation of the Matrix Exponential}
\label{CFK:sec:matexp} 
The matrix exponential is defined by the power series 
\[ e^A = \sum_{j=0}^\infty \frac{1}{j!}A^j.\]
A simple approach to numerically approximate $e^{A}$ is through a Pad\'e or 
Taylor series approximation. Other methods of approximating the matrix 
exponential are discussed in \cite{CFK:Moler2003}.

We choose to implement a $(p,q)$-Pad\'e approximation 
$e^{A}\approx \left[Q_{pq}(A)\right]^{-1}P_{pq}(A)$, where $P_{pq}(A)$ and 
$Q_{pq}(A)$ are defined as follows:

\begin{align}
\label{CFK:eqn:PadeP}
P_{pq}(A) &= \sum_{j=0}^p\frac{(p+q-j)!p!}{(p+q)!j!(p-j)!}A^j\\
\label{CFK:eqn:PadeQ}
Q_{pq}(A) &= \sum_{j=0}^q\frac{(p+q-j)!q!}{(p+q)!j!(q-j)!}(-A)^j
\end{align}

After we calculate the terms $P_{pq}$ and $Q_{pq}$, the product 
$e^A\approx\left[Q_{pq}(A)\right]^{-1}P_{pq}(A)$ is a potentially expensive 
computation because of the matrix inversion and matrix products. 
Fortunately, for our application, the matrix $A$ we consider has a special 
structure that allows us to approximate $e^A$ efficiently and accurately. 
This implementation is further discussed in Section \ref{CFK:sec:homme}.

The error for the $(p,q)$-Pad\'e approximation is given by
\[e^A-\left[Q_{pq}(A)\right]^{-1}P_{pq}(A) = \mathcal{O}(\|A\|^{p+q+1}),\] 
though in practice, this may be a particularly pessimistic estimation of 
the error, as shown in Table \ref{CFK:tab:PadeError}. If the matrix $A$ is 
ill-conditioned, the Pad\'e  approximation can be especially inaccurate. 
To mitigate this problem, we implement a scaling and squaring approach. We 
briefly outline this procedure here; for further detail and error analysis 
of the scaling and squaring method, see \cite{CFK:Al-Mohy2009} and 
\cite{CFK:higham2005}.


To scale $e^A$, we take advantage of the properties of matrix exponentials 
and write it as
\[e^{A} = \left(e^{A/k}\right)^k,\]
where we choose $k$ to be the smallest power of $2$ so that $\|A/k\|_2
\leq 0.5$. With this factorization, the matrix $A$ is scaled down to $A/k$, 
and the matrix exponential $e^{A/k}$ is calculated using the Pad\'e 
formulas given in equations \ref{CFK:eqn:PadeP} and \ref{CFK:eqn:PadeQ}. 
The resulting matrix exponential is then squared repeatedly to recover the 
desired matrix exponential $e^{A}$. This numerical approximation to the 
matrix exponential $e^A$ is then used with an explicit $r$-stage RK method, 
as described in Section \ref{CFK:sec:ifrk}, to solve equation 
\ref{CFK:eqn:vode}.

\section{Implementation with HOMME-NH}\label{CFK:sec:homme}
As mentioned in Section \ref{CFK:sec:matexp}, the specific structure of 
the Jacobian in HOMME-NH allows us to form the matrix exponential $e^A 
\approx \left[Q_{pq}(A)\right]^{-1}P_{pq}(A)$ efficiently. HOMME-NH is a 
nonhydrostatic atmosphere model whose state variables are listed in Table 
\ref{CFK:tab:variables}. 
\begin{table}[ht]
  \caption{Variables in HOMME-NH}
  \label{CFK:tab:variables}
  \begin{center}
    \begin{tabular}{|c|l|}
      \hline
      \textbf{Variable Name} & \textbf{Description} \\
      \hline
      $\CFKg$                       & Gravitational constant                                  \\
      $\vec{u}=\left(u,v\right)^T$  & Horizontal velocity                                     \\
      $w$                           & Vertical velocity                                       \\
      $\phi$                        & Geopotential                                            \\
      $\theta$                      & Potential temperature                                   \\
      $\pi$                         & Hydrostatic pressure                                    \\
      $\eta$                        & Mass-based hybrid terrain-following vertical coordinate \\
      $p_{nh}$                      & Nonhydrostatic pressure                                 \\
      $\mu$                         & $\frac{\partial p_{nh}}{\partial\eta}/\frac{\partial\pi}{\partial\eta}$  \\
      \hline
    \end{tabular}
  \end{center}
\end{table}
The governing equations can be decomposed into non-stiff and stiff terms as follows \cite{CFK:Steyer2019}:



\[ \omega_t \coloneqq \begin{bmatrix} \vec{u_t} \\
w_t\\
\phi_t\\
\theta_t\\
\frac{\partial \pi}{\partial \eta}
\end{bmatrix} = n(\omega) + s(\omega),\text{ with }
 s(\omega) = \begin{bmatrix}
0\\
-\CFKg (1-\mu)\\
\CFKg w\\
0\\
0\end{bmatrix}.\]

Linearizing $s(\omega)$ gives the following Jacobian:
\begin{equation}\label{CFK:eqn:Jacobian} J = \begin{bmatrix}
0&                  &                                                   &  & \\
 & 0                & \CFKg \frac{\partial \mu}{\partial \phi} &  & \\
 & \CFKg  I & 0                                                 &  & \\
 &                  &                                                   &0 & \\
 &                  &                                                   &  &0\end{bmatrix},\end{equation}

where $\dfrac{\partial \mu}{\partial \phi}$ is tridiagonal. As explained 
in Section \ref{CFK:sec:ifrk}, IFRK methods require the formation of the 
matrix exponential $e^{\alpha J}$. Since $J$ has the form given in 
\ref{CFK:eqn:Jacobian}, the matrix exponential will have the form
\[ e^{\alpha J} = \begin{bmatrix}
I&                                                                     &  & \\
 & \exp\left(\begin{bmatrix}0 & \CFKg \alpha \frac{\partial \mu}{\partial \phi} \\ 
  \CFKg \alpha I & 0     \end{bmatrix}\right)     &  & \\                                      
 &                                                                     &I & \\
 &                                                                     &  &I\end{bmatrix}, \quad \alpha \neq 0.\]

So, forming $e^{\alpha J}$ for $\alpha \neq 0$ reduces to forming an 
exponential of the tridiagonal-like matrix $A \coloneqq 
\begin{bmatrix}
   0              & \CFKg \alpha \frac{\partial \mu}{\partial \phi} \\
 \CFKg \alpha I & 0  \end{bmatrix}$, and the matrix exponential will 
only act on variables $w$ and $\phi$. 

The structure of $A$ allows us to solve 
$e^A \approx \left[Q_{pq}(A)\right]^{-1}P_{pq}(A)$ using tridiagonal solves 
and back substitution. To do so, we first factor $Q_{pq}(A)$ as
\begin{align*}
Q_{pq}(A) &= \sum_{j=0}^q\frac{(p+q-j)!q!}{(p+q)!j!(q-j)!}(-A)^j\\
          &= \kappa\prod_{j=1}^q\left[\sigma_jI-A\right],
\end{align*}
where $\sigma_j\in \mathbb{C}$ for $j=1,\dots,q$. Since we want to solve 
for $R \coloneqq \left[Q_{pq}(A)\right]^{-1}P_{pq}(A)$, we write
\begin{align*}
% Q_{pq}(A) R &= P_{pq}(A)\\
\prod_{j=1}^q\left[\sigma_jI-A\right]R &= \frac{1}{\kappa}P_{pq}(A).
\end{align*}

Define $R_1 \coloneqq \left[\sigma_2I-A\right]\left[\sigma_3I-A\right]
\cdots\left[\sigma_qI-A\right]R$. Then our equation becomes
\begin{equation}\label{CFK:eqn:PadeApprox} \left[\sigma_1I-A\right]R_1 
= \frac{1}{\kappa}P_{pq}(A).\end{equation} Note that 
$\left[\sigma_1I-A\right] =
 \begin{bmatrix} \sigma_1 I  & -\CFKg\alpha \frac{\partial\mu}{\partial\phi} \\
 -\CFKg\alpha I            & \sigma_1 I \end{bmatrix}.$ This form allows 
us to solve for $R_1$ using far fewer operations than if 
$\left[\sigma_1I-A\right]$ were a full matrix. To do this, we similarly 
partition $R_1$ and $\frac{1}{\kappa}P_{pq}(A)$ into block matrices: 
\[ R_1 = \begin{bmatrix} \hat{R_1} \\ \hat{R_2}\end{bmatrix} \qquad P_{pq}(A)
 = \begin{bmatrix} \hat{P_1} \\ \hat{P_2}\end{bmatrix}.\]
Then equation \ref{CFK:eqn:PadeApprox} becomes 
\[\begin{bmatrix} \sigma_1 I  & -\CFKg\alpha \frac{\partial\mu}{\partial\phi} \\
           -\CFKg\alpha I & \sigma_1 I \end{bmatrix}
\begin{bmatrix} \hat{R_1} \\
 \hat{R_2} \end{bmatrix} = 
\begin{bmatrix} \hat{P_1} \\
 \hat{P_2} \end{bmatrix}.\]

If $\sigma_1 = 0$ this decomposes to a tridiagonal linear solve and a 
trivial solve. If $\sigma_1 \neq 0$, then we left multiply by 
$\begin{bmatrix} I & 0 \\ \CFKg\alpha \sigma_1^{-1}I & I \end{bmatrix}$ 
to obtain:
\[\begin{bmatrix} 
 \sigma_1 I  & -\CFKg\alpha \frac{\partial\mu}{\partial\phi} \\
         0 & \sigma_1 I -\left(\CFKg\alpha\right)^2  \sigma_1^{-1}\frac{\partial\mu}{\partial\phi}
 \end{bmatrix}
 \begin{bmatrix} \hat{R_1} \\
 \hat{R_2} \end{bmatrix} = 
\begin{bmatrix} \hat{P_1} \\
 \CFKg\alpha \sigma_1^{-1} \hat{P_1} +  \hat{P_2} \end{bmatrix}.\]
The matrix block $\left[\sigma_1 I -\left(\CFKg\alpha\right)^2\sigma_1^{-1}\frac{\partial\mu}{\partial\phi}\right]$ 
is tridiagonal since $\frac{\partial\mu}{\partial\phi}$ is tridiagonal. 
Therefore we can solve for $\hat{R_2}$ with a tridiagonal 
solve:
\[\left[\sigma_1 I -\left(\CFKg\alpha \right)^2  \sigma_1^{-1}\frac{\partial\mu}{\partial\phi}\right]\hat{R_2}
 = \left[\CFKg\alpha\sigma_1^{-1} \hat{P_1} +  \hat{P_2}\right],\]
and then form $\hat{R_1}$ as 
\[\hat{R_1} = \sigma_1^{-1}\left[P_1 + \CFKg\alpha\frac{\partial \mu}{\partial \phi}\right] \hat{R_2}.\]

In this way, we have just solved equation \ref{CFK:eqn:PadeApprox} for $R_1 = \begin{bmatrix} \hat{R_1}\\ \hat{R_2}\end{bmatrix}$. 
On the other hand, we also have
\[\left[\sigma_2I-A\right]\left[\sigma_3I-A\right]\cdots\left[\sigma_qI-A\right]R = R_1.\] 
We can iteratively repeat the same procedure, defining 
\[R_j \coloneqq \left[\sigma_{j+1}I-A\right]\left[\sigma_{j+2}I-A\right]\cdots\left[\sigma_qI-A\right]R\]
 and solving $\left[\sigma_jI-A\right]R_j = R_{j-1}$ for $R_j$, continuing 
in this way until we arrive at \[\left[\sigma_qI-A\right]R = R_{q-1}.\] 
Solving this last tridiagonal system gives us the $R = \left[Q_{pq}(A)\right]^{-1}P_{pq}(A)\approx e^A$
 that we are looking for.

This algorithm for computing $R \approx e^A$ is particularly efficient if 
the values of $p$ and $q$ are small, so that we can compute $\{\sigma_j\}_
{j=1}^q$ by hand ahead of time. To validate the use of a $(p,q)$-Pad\'e 
approximation, and to determine how large $p$ and $q$ must be, we let the 
model spin up to 15 days and consider the Jacobian at that timestep. In 
HOMME-NH, the Jacobian will always have unique, purely imaginary 
eigenvalues. This allows us to calculate the matrix exponential 
analytically and compare it to the $(p,q)$-Pad\'e approximation.

To calculate $e^A$ analytically, suppose $\lambda_1, \lambda_2, \dots, 
\lambda_k$ are the unique eigenvalues of $A$, and $V$ is the matrix of 
corresponding eigenvectors. Then the Schur decomposition of $A$ is 
\[A = V \begin{bmatrix} \lambda_1 &           &        &           \\
                                  & \lambda_2 &        &           \\
                                  &           & \ddots &           \\
                                  &           &        & \lambda_k \end{bmatrix}
 V^{-1},\] and the matrix exponential can be analytically computed to 
machine precision as
\begin{align*}
e^A &= V \exp\left(\begin{bmatrix} \lambda_1 &           &        &           \\
                                             & \lambda_2 &        &           \\
                                             &           & \ddots &           \\
                                             &           &        & \lambda_k \end{bmatrix}\right) V^{-1} \\
  &= V \begin{bmatrix} e^{\lambda_1} &               &        &               \\
                                     & e^{\lambda_2} &        &               \\
                                     &               & \ddots &               \\
                                     &               &        & e^{\lambda_k} \end{bmatrix} V^{-1}.
\end{align*}
Table \ref{CFK:tab:PadeError} gives the error of several diagonal $(p,q)$-
Pad\'e approximations, for different values of $p=q$.
\begin{table}[ht]
  \begin{center}
    \caption{Error of Pad\'e approximation as compared to analytic 
               computation of $e^A$.}
    \label{CFK:tab:PadeError}
    \begin{tabular}{|c|c|}
      \hline
      \textbf{Value of $p=q$} & \textbf{Error}\\
      \hline
      2 & 1.30e-10 \\
      3 & 5.25e-13 \\
      4 & 4.92e-13 \\
      5 & 5.42e-13 \\
      \hline
    \end{tabular}
  \end{center}
\end{table}

Since a $(2,2)$-Pad\'e approximation yields a considerably accurate matrix 
exponential and also gives the benefit of easily solving for the 
coefficients $\{\sigma_1, \sigma_2\}$ ahead of time, this is the 
approximation we choose to implement in our IFRK methods.

\section{Integrating Factor Runge-Kutta Methods}\label{CFK:sec:ifrk}
The focus of this paper is to implement IFRK methods in the HOMME-NH 
nonhydrostatic atmosphere model. IFRK methods were introduced in 
\cite{CFK:Lawson1969} and shown to be a type of exponential RK method by
\cite{CFK:Minchev2006}.

For IFRK methods, we use an explicit $r$-stage RK method to solve 
equation \ref{CFK:eqn:vode}. If the Butcher tableau is given by 
$\begin{array}{c|c}
c & A \\ \hline & b^T \end{array}$, then the solution to equation \ref{CFK:eqn:vode} 
with initial condition $v(t_0) = v_0$ and step-size $\Delta t$ is given by
\[ \left\{\begin{array}{l} v_{m+1} = v_m + \Delta t\sum_{k=1}^r b_k 
                         e^{-L_m(t_{m,k}-t_m)}N(e^{L_m(t_{m,k}-t_m)}g_k) \\
          g_j = v_m + \Delta t \sum_{k=1}^r A_{j,k} e^{-L_m(t_{m,k} - t_m)} 
                      N(e^{L_m(t_{m,k}-t_m)}g_k), \end{array} \right. \]
for $j = 1,\dots,r$, where $t_{m,k} = t_m + c_k \Delta t$.
The naming convention we use for the explicit $r$-stage RK methods is ``$ERK
-nm$,'' where $n$ is the order of the method, and $m$ is the number of
stages. Here, we consider four explicit RK methods, given by the Butcher 
tableaux below.
\begin{align*}&\text{ERK-}12:
 \begin{array}{c|ccc}
0   & 0 & 0 & 0\\
1   & 1 & 0 & 0\\
1   & 0 & 1 & 0\\
\hline
    & 0   & 1 & 0
\end{array}
& \text{ERK-}35: 
\begin{array}{c|cccccc}
0   & 0   & 0   & 0   & 0   & 0   & 0\\
1/5 & 1/5 & 0   & 0   & 0   & 0   & 0\\
1/5 & 0   & 1/5 & 0   & 0   & 0   & 0\\
1/3 & 0   & 0   & 1/3 & 0   & 0   & 0\\
2/3 & 0   & 0   & 0   & 2/3 & 0   & 0\\
1   & 1/4 & 0   & 0   & 0   & 3/4 & 0\\
\hline
    & 1/4 & 0   & 0   & 0   & 3/4 & 0
\end{array}\\
\\
&\text{ERK-}23: 
\begin{array}{c|cccc}
0   & 0   & 0   & 0 & 0\\
1/2 & 1/2 & 0   & 0 & 0\\
1/2 & 0   & 1/2 & 0 & 0\\
1   & 0   & 0   & 1 & 0\\
\hline
    & 0   & 0   & 1 & 0
\end{array}
& \text{ERK-}43: 
\begin{array}{c|cccc}
0   & 0   & 0   & 0   & 0 \\
1/2 & 1/2 & 0   & 0   & 0 \\
1/2 & 0   & 1/2 & 0   & 0 \\
1   & 0   & 0   & 1   & 0 \\
\hline
    & 1/6 & 1/3 & 1/3 & 1/6
\end{array} 
\end{align*}

\section{Results}\label{CFK:sec:results}
After implementing each of the methods described in Section 
\ref{CFK:sec:ifrk} into HOMME-NH, we tested their convergence in the 
DCMIP2012 Test Case 4.1 (baroclinic instability test case) \cite{dcmip2012}.  We ran the
test case for 15 days with a 300 second time-step using a trusted second order 
implicit-explicit Runge-Kutta method to generate a nontrivial flow. The model 
is then restarted at day 15 and integrated over a 0.1 second time-interval 
for convergence testing.  For the ``truth'', we compared our exponential integrating 
factor methods to a third order, five stage Ullrich method (equation $56$ in 
\cite{CFK:Guerra2016}) with a timestep of $10^{-4}$, calculating the 
maximum $2$-norm error over all latitudes and longitudes. To verify our 
methods, we calculate the error of the stiff variables, $w$ and $\phi$, 
which the matrix exponential acts upon. We also calculate the error of $u$ 
and $v$, which the matrix exponential does not affect, as reference 
variables. The absolute errors are listed in Table \ref{CFK:tab:abs_err}, 
and the relative errors are listed in Table \ref{CFK:tab:rel_err}.

\begin{table}[ht]
  \centering
  \caption{Absolute error of state variables}
  \label{CFK:tab:abs_err}
  \scalebox{0.6}{\subtable[Absolute error of $u$]{\begin{tabular}{c|c|c}
      \textbf{Method} & \textbf{$\Delta t$} & \textbf{Error}\\
      \hline
      ERK-12          & $0.1$            & $3.59$e-$6$ \\
      ERK-12          & $0.05$           & $4.11$e-$7$ \\
      ERK-12          & $0.02$           & $1.31$e-$7$ \\
      ERK-12          & $0.01$           & $1.17$e-$7$ \\
      \hline
      ERK-23          & $0.1$            & $8.41$e-$7$ \\
      ERK-23          & $0.05$           & $2.12$e-$7$ \\
      ERK-23          & $0.02$           & $3.40$e-$8$ \\
      ERK-23          & $0.01$           & $8.50$e-$9$ \\
      \hline
      ERK-35          & $0.1$            & $3.15$e-$9$ \\
      ERK-35          & $0.05$           & $5.20$e-$11$ \\
      ERK-35          & $0.02$           & $1.00$e-$11$ \\
      ERK-35          & $0.01$           & $2.05$e-$12$ \\
      \hline
      ERK-43          & $0.1$            & $1.63$e-$8$ \\
      ERK-43          & $0.05$           & $1.03$e-$9$ \\
      ERK-43          & $0.02$           & $2.60$e-$11$ \\
      ERK-43          & $0.01$           & $1.60$e-$12$
    \end{tabular}}}
  \quad
  \scalebox{0.6}{\subtable[Absolute error of $v$]{\begin{tabular}{c|c|c}
      \textbf{Method} & \textbf{$\Delta t$} & \textbf{Error}\\
      \hline
      ERK-12          & $0.1$            & $1.43$e-$6$ \\
      ERK-12          & $0.05$           & $1.78$e-$7$ \\
      ERK-12          & $0.02$           & $5.33$e-$8$ \\
      ERK-12          & $0.01$           & $4.72$e-$8$ \\
      \hline
      ERK-23          & $0.1$            & $3.42$e-$7$ \\
      ERK-23          & $0.05$           & $8.55$e-$8$ \\
      ERK-23          & $0.02$           & $1.37$e-$8$ \\
      ERK-23          & $0.01$           & $3.42$e-$9$ \\
      \hline
      ERK-35          & $0.1$            & $6.32$e-$9$ \\
      ERK-35          & $0.05$           & $1.17$e-$10$ \\
      ERK-35          & $0.02$           & $1.92$e-$11$ \\
      ERK-35          & $0.01$           & $3.59$e-$12$ \\
      \hline
      ERK-43          & $0.1$            & $7.99$e-$9$ \\
      ERK-43          & $0.05$           & $5.01$e-$10$ \\
      ERK-43          & $0.02$           & $1.27$e-$11$ \\
      ERK-43          & $0.01$           & $8.16$e-$13$
    \end{tabular}}}\quad
  \scalebox{0.6}{\subtable[Absolute error of $w$]{\begin{tabular}{c|c|c}
      \textbf{Method} & \textbf{$\Delta t$} & \textbf{Error}\\
      \hline
      ERK-12          & $0.1$            & $6.85$e+$0$ \\
      ERK-12          & $0.05$           & $4.55$e+$0$ \\
      ERK-12          & $0.02$           & $2.03$e+$0$ \\
      ERK-12          & $0.01$           & $1.05$e+$0$ \\
       \hline
      ERK-23          & $0.1$            & $1.80$e+$0$ \\
      ERK-23          & $0.05$           & $4.48$e-$1$ \\
      ERK-23          & $0.02$           & $7.16$e-$2$ \\
      ERK-23          & $0.01$           & $1.79$e-$2$ \\
      \hline
      ERK-35          & $0.1$            & $2.12$e-$2$ \\
      ERK-35          & $0.05$           & $2.56$e-$3$ \\
      ERK-35          & $0.02$           & $1.60$e-$4$ \\
      ERK-35          & $0.01$           & $2.00$e-$5$ \\
      \hline
      ERK-43          & $0.1$            & $5.02$e-$2$ \\
      ERK-43          & $0.05$           & $3.16$e-$3$ \\
      ERK-43          & $0.02$           & $8.12$e-$5$ \\
      ERK-43          & $0.01$           & $5.09$e-$6$

    \end{tabular}}}\quad
   \scalebox{0.6}{\subtable[Absolute error of $\phi$]{\begin{tabular}{c|c|c}
      \textbf{Method} & \textbf{$\Delta t$} & \textbf{Error}\\
      \hline
      ERK-12          & $0.1$            & $9.12$e+$2$ \\
      ERK-12          & $0.05$           & $4.45$e+$2$ \\
      ERK-12          & $0.02$           & $1.79$e+$1$ \\
      ERK-12          & $0.01$           & $8.97$e+$1$ \\
      \hline
      ERK-23          & $0.1$            & $5.05$e-$1$ \\
      ERK-23          & $0.05$           & $1.28$e-$1$ \\
      ERK-23          & $0.02$           & $2.05$e-$2$ \\
      ERK-23          & $0.01$           & $5.13$e-$3$ \\
      \hline
      ERK-35          & $0.1$            & $1.13$e-$1$ \\
      ERK-35          & $0.05$           & $1.41$e-$2$ \\
      ERK-35          & $0.02$           & $8.99$e-$4$ \\
      ERK-35          & $0.01$           & $1.12$e-$4$ \\
      \hline
      ERK-43          & $0.1$            & $2.05$e-$2$ \\
      ERK-43          & $0.05$           & $1.29$e-$3$ \\
      ERK-43          & $0.02$           & $3.31$e-$5$ \\
      ERK-43          & $0.01$           & $2.06$e-$6$
    \end{tabular}}}
\end{table}

\begin{table}[ht]
  \centering
  \caption{Relative error of state variables}
  \label{CFK:tab:rel_err}
  \scalebox{0.6}{\subtable[Relative error of $u$]{\begin{tabular}{c|c|c}
      \textbf{Method} & \textbf{$\Delta t$} & \textbf{Error}\\
      \hline
      ERK-12          & $0.1$            & $2.52$e-$7$ \\
      ERK-12          & $0.05$           & $2.89$e-$8$ \\
      ERK-12          & $0.02$           & $9.22$e-$9$ \\
      ERK-12          & $0.01$           & $8.18$e-$9$ \\
       \hline
      ERK-23          & $0.1$            & $5.90$e-$8$ \\
      ERK-23          & $0.05$           & $1.49$e-$8$ \\
      ERK-23          & $0.02$           & $2.39$e-$9$ \\
      ERK-23          & $0.01$           & $5.97$e-$10$ \\
      \hline
      ERK-35          & $0.1$            & $2.21$e-$10$ \\
      ERK-35          & $0.05$           & $3.65$e-$12$ \\
      ERK-35          & $0.02$           & $7.03$e-$13$ \\
      ERK-35          & $0.01$           & $1.44$e-$13$ \\
      \hline
      ERK-43          & $0.1$            & $1.15$e-$9$ \\
      ERK-43          & $0.05$           & $7.20$e-$11$ \\
      ERK-43          & $0.02$           & $1.83$e-$12$ \\
      ERK-43          & $0.01$           & $1.13$e-$13$

    \end{tabular}}}
  \quad
  \scalebox{0.6}{\subtable[Relative error of $v$]{\begin{tabular}{c|c|c}
      \textbf{Method} & \textbf{$\Delta t$} & \textbf{Error}\\
      \hline
      ERK-12          & $0.1$            & $1.83$e-$7$ \\
      ERK-12          & $0.05$           & $2.27$e-$8$ \\
      ERK-12          & $0.02$           & $6.81$e-$9$ \\
      ERK-12          & $0.01$           & $6.03$e-$9$ \\
      \hline
      ERK-23          & $0.1$            & $4.36$e-$8$ \\
      ERK-23          & $0.05$           & $1.09$e-$8$ \\
      ERK-23          & $0.02$           & $1.75$e-$9$ \\
      ERK-23          & $0.01$           & $4.37$e-$10$ \\
      \hline
      ERK-35          & $0.1$            & $8.07$e-$10$ \\
      ERK-35          & $0.05$           & $1.49$e-$11$ \\
      ERK-35          & $0.02$           & $2.45$e-$12$ \\
      ERK-35          & $0.01$           & $4.58$e-$13$ \\
      \hline
      ERK-43          & $0.1$            & $1.02$e-$9$ \\
      ERK-43          & $0.05$           & $6.40$e-$11$ \\
      ERK-43          & $0.02$           & $1.62$e-$12$ \\
      ERK-43          & $0.01$           & $1.04$e-$13$
    \end{tabular}}}\quad
  \scalebox{0.6}{\subtable[Relative error of $w$]{\begin{tabular}{c|c|c}
      \textbf{Method} & \textbf{$\Delta t$} & \textbf{Error}\\
      \hline
      ERK-12          & $0.1$            & $6.00$e+$3$ \\
      ERK-12          & $0.05$           & $3.98$e+$3$ \\
      ERK-12          & $0.02$           & $1.78$e+$3$ \\
      ERK-12          & $0.01$           & $9.22$e+$2$ \\
       \hline
      ERK-23          & $0.1$            & $1.58$e+$3$ \\
      ERK-23          & $0.05$           & $3.92$e+$2$ \\
      ERK-23          & $0.02$           & $6.27$e+$1$ \\
      ERK-23          & $0.01$           & $1.57$e+$1$ \\
      \hline
      ERK-35          & $0.1$            & $1.85$e+$1$ \\
      ERK-35          & $0.05$           & $2.24$e+$0$ \\
      ERK-35          & $0.02$           & $1.40$e-$1$ \\
      ERK-35          & $0.01$           & $1.75$e-$2$ \\
      \hline
      ERK-43          & $0.1$            & $4.40$e+$1$ \\
      ERK-43          & $0.05$           & $2.77$e+$0$ \\
      ERK-43          & $0.02$           & $7.11$e-$2$ \\
      ERK-43          & $0.01$           & $4.45$e-$3$
    \end{tabular}}}\quad
  \scalebox{0.6}{\subtable[Relative error of $\phi$]{\begin{tabular}{c|c|c}
      \textbf{Method} & \textbf{$\Delta t$} & \textbf{Error}\\
      \hline
      ERK-12          & $0.1$            & $1.14$e-$4$ \\
      ERK-12          & $0.05$           & $5.58$e-$5$ \\
      ERK-12          & $0.02$           & $2.24$e-$5$ \\
      ERK-12          & $0.01$           & $1.12$e-$5$ \\
      \hline
      ERK-23          & $0.1$            & $6.33$e-$7$ \\
      ERK-23          & $0.05$           & $1.60$e-$7$ \\
      ERK-23          & $0.02$           & $2.57$e-$8$ \\
      ERK-23          & $0.01$           & $6.44$e-$9$ \\
      \hline
      ERK-35          & $0.1$            & $1.41$e-$7$ \\
      ERK-35          & $0.05$           & $1.76$e-$8$ \\
      ERK-35          & $0.02$           & $1.13$e-$9$ \\
      ERK-35          & $0.01$           & $1.41$e-$10$ \\
      \hline
      ERK-43          & $0.1$            & $2.57$e-$8$ \\
      ERK-43          & $0.05$           & $1.62$e-$9$ \\
      ERK-43          & $0.02$           & $4.15$e-$11$ \\
      ERK-43          & $0.01$           & $2.59$e-$12$
    \end{tabular}}}
\end{table}

Note that the value of $w$ is small, so even though the absolute error 
of the IFRK methods is satisfactory, the relative error is rather
 large. Recall from Table \ref{CFK:tab:PadeError} that the error of the 
$(2,2)$-Pad\`e approximation that we are implementing is $\mathcal{O}(10^{-10})$.
This does not take into account the error from the IFRK method itself, 
and combining this error with the loss of digits that may happen because of 
the small values of $w$, it is not surprising that the relative error of 
$w$ is larger than that of the other variables.

We graph these errors in Figure \ref{CFK:fig:convtest}. The slope of these 
methods flattens out as the timestep goes to zero. One possible 
explanation for this is that the accuracy may be limited by the accuracy of 
the matrix exponential. Another potential explanation is that we are 
limited by the accuracy of the ``truth.'' 

\begin{figure}[h]
\label{CFK:fig:convtest}
\begin{center}
\begin{tabular}{cc}
\scalebox{0.24}{\includegraphics{plots/CFKabsu.jpg}} 
&
\scalebox{0.24}{\includegraphics{plots/CFKabsv.jpg}}
\\
\scalebox{0.24}{\includegraphics{plots/CFKabsw.jpg}} 
&
\scalebox{0.24}{\includegraphics{plots/CFKabsphi.jpg}}
\end{tabular}
\end{center}
\caption{Log-log plot of the absolute errors of IFRK methods.}
\end{figure}
\begin{figure}
\begin{center}
\begin{tabular}{cc}
\scalebox{0.24}{\includegraphics{plots/CFKrelu.jpg}} 
&
\scalebox{0.24}{\includegraphics{plots/CFKrelv.jpg}}
\\
\scalebox{0.24}{\includegraphics{plots/CFKrelw.jpg}} 
&
\scalebox{0.24}{\includegraphics{plots/CFKrelphi.jpg}}
\end{tabular}
\end{center}
\caption{Log-log plot of the relative errors of IFRK methods.}
\end{figure}

\section{Conclusions}
Another important matter to take into consideration is that the Jacobian 
at each point of our discretization scheme can be computed at the 
beginning of each time step, and we can do this computation in parallel. 
Furthermore, the IFRK methods rely only on the local-in-time Jacobian, so 
we can do the IFRK computation in parallel as well.

The IFRK methods allow us to deal with stiff initial value problems with a 
larger step-size than a fully explicit method, and the opportunity for 
parallelization with HOMME-NH boosts efficiency. Though the formation of 
the matrix exponential can be a costly computation, we are able to take 
advantage of the tridiagonal-like form of the Jacobian in HOMME-NH, to 
implement the IFRK methods in a way that mitigates the cost of forming the 
matrix exponential.

We have shown that IFRK methods are accurate and can be implemented in 
parallel. However, more work is needed to compare the efficiency of these 
methods, which will determine if IFRK methods can be competitive with 
the IMEX RK methods that are currently implemented in HOMME-NH. In 
particular, the efficiency of the IFRK methods will depend on how large of 
a step-size they can take, and this remains to be done.

\bibliographystyle{siam}
% Edit the line below to be your first and last names.
\bibliography{CassidyKrause}

% Edit FirstnameLastname below to be your first and last names, but leave the line commented out.
% This line will help me merge bibliographies for the proceedings.
%\input{CassidyKrause.bbl}

\end{document}
